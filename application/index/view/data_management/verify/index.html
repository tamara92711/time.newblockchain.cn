{extend name="/common/templates/tpl-w-sb"} {block name="page-title"}实名认证{/block} {block name="custom-css"}
<link rel="stylesheet" href="/assets/css/index/index/real-name-veri.css"> {/block} {block name="main-part"}
<div>
    <div class="qk-portlet" style="margin-top:1px;width: 940px;margin-left:-2px">
        <div class="qk-portlet-title">
            <img class="qk-portlet-title-icon" src="/assets/img/personal.png" />
            <span class="qk-portlet-title-text">个人信息</span>
        </div>
        <div class="qk-portlet-content form">
            <form action="/index/data_management/verify" id="verifyForm" enctype="multipart/form-data" method="POST">
                <div>
                    <div style="float:left;width:675px">
                        <div class="form-group" style="width:652px">
                            <div class="left">
                                <label>姓名：</label>
                            </div>
                            <div class="right">
                                <input type="text" class="form-control" name="name" id="name" />
                            </div>
                            <!--<label class="error" for="name" id="name_error">这是必填栏。</label>-->
                        </div>
                        <div class="form-group" style="width:652px">
                            <div class="left">
                                <label>身份证号码：</label>
                            </div>
                            <div class="right">
                                <input type="text" class="form-control" name="iden_number" id="iden_number" />
                            </div>
                            <!--<label class="error" for="iden_number" id="iden_number_error">这是必填栏。</label>-->
                        </div>
                        <div class="form-group" style="height: 148px;width:652px">
                            <div class="left">
                                <label>身份证正面：</label>
                            </div>
                            <div id="image-preview-positive" class="right add-picture">
                                <input type="file" name="positive_id" id="positive_id" />
                            </div>
                        </div>
                    </div>
                    <div class="add-avatar">
                    </div>
                </div>

                <div class="form-group" style="height: 148px">
                    <div class="left">
                        <label>身份证反面：</label>
                    </div>
                    <div id="image-preview-negative" class="right add-picture">
                        <input type="file" name="negative_id" id="negative_id" />
                    </div>
                </div>



                <div class="form-group" style="height: 147px;border-bottom:none">
                    <div class="left">
                        <label>手持身份证：</label>
                    </div>
                    <div id="image-preview-handheld" class="right add-picture">
                        <input type="file" name="handheld_id" id="handheld_id" />
                    </div>
                </div>

                <div class="form-group" style="border-bottom:none">
                    <div class="left" style="height:1px"></div>
                    <div class="right">
                        <button class="btn" style="background-color: #ff5656;width: 180px;margin-top: -9px;height: 40px;color: white;font-size:14px;font-family:ms-yahei-bold" id="confirm">提交</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
{/block} {block name="custom-js"}
<script type="text/javascript" src="/assets/js/uploadpreview.min.js"></script>
<script>
    $(document).ready(function () {       
        var video, $output;
        var scale = 0.25;
        var is_captured = false;

        var initialize = function () {
            $output = $("#output");
            displayVideo();
            $(".add-avatar").click(function () {
                if (is_captured)
                {
                    is_captured = false;
                    displayVideo();
                }
                else{
                    is_captured = true;
                    captureImage();
                }
            });
        };
        
        var displayVideo = function() {
            var html = '<video id="video" style="width: 220px;height: 240px;border: 1px solid #ff5656;" autoplay></video>';
            $(".add-avatar").html(html);
            video = $("#video").get(0);
            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                // Not adding `{ audio: true }` since we only want video now
                navigator.mediaDevices.getUserMedia({ video: true }).then(function (stream) {
                    video.src = window.URL.createObjectURL(stream);
                    video.play();
                });
            }
        }
        var captureImage = function () {
            var canvas = document.createElement("canvas");
            canvas.width = 220;
            canvas.height = 240;
            canvas.getContext('2d')
                .drawImage(video, 0, 0, canvas.width, canvas.height);
            var html = '<img id="captured-image" />';
            html += '<input type="hidden" id="avatar_image" name="avatar_image">';
            $(".add-avatar").html(html)
            $("#captured-image").attr('src', canvas.toDataURL());
            $("#avatar_image").val(canvas.toDataURL());
        };

        $(initialize);           

        $.uploadPreview({
            input_field: "#positive_id",
            preview_box: "#image-preview-positive",
            label_selected: "Change File"
        });

        $.uploadPreview({
            input_field: "#negative_id",
            preview_box: "#image-preview-negative",
            label_selected: "Change File"
        });

        $.uploadPreview({
            input_field: "#handheld_id",
            preview_box: "#image-preview-handheld",
            label_selected: "Change File"
        });

        $("#verifyForm").submit(function () {
            if ($("#name").val() == "") {
                alert("你应该添加“姓名”！");
                return false;
            }

            if ($("#iden_number").val() == "") {
                alert("你应该添加“身份证号码”！");
                return false;
            }

            if ($("#positive_id").val() == "") {
                alert("你应该添“加身份证正面”！");
                return false;
            }

            if ($("#negative_id").val() == "") {
                alert("你应该添加“身份证反面”！");
                return false;
            }

            if ($("#handheld_id").val() == "") {
                alert("你应该添加“手持身份证”！");
                return false;
            }

            if ($("#captured-image").length == 0) {
                alert("你应该拍照“头像”！")
                return false;
            }
        });
    });
</script> {/block}