{extend name="/common/templates/tpl-w-sb"}
{block name="page-title"}个人信息{/block}
{block name="custom-css"}
<link rel="stylesheet" href="/assets/css/index/index/personal_info.css">
{/block}
{block name="main-part"}
<div style="height:896px">
    <div class="qk-portlet" style="margin-top:1px;width: 940px;margin-left:-2px">
        <div class="qk-portlet-title">
            <img class="qk-portlet-title-icon" src="/assets/img/personal.png" />
            <span class="qk-portlet-title-text">个人信息</span>
        </div>
        <div class="qk-portlet-content form" style="height: 791px">
            <form id="personal_form" class="form-horizontal">
                <div class="form-group">
                    <div class="left">
                        <label for="username">用户名：</label>
                    </div>
                    <div class="right">
                        <input type="text" class="form-control" name="username" id="username" value="{$user_data[0]['name']}" readonly/>
                    </div>
                    <label class="error" for="username" id="username_error">这是必填栏。</label>
                </div>

                <div class="form-group">
                    <div class="left">
                        <label>真实姓名：</label>
                    </div>
                    <div class="right">
                        <input type="text" class="form-control" name="realname" id="realname" value="{$user_data[0]['real_name']}"/>
                    </div>
                    <label class="error" for="realname" id="realname_error">这是必填栏。</label>
                </div>
                <div class="form-group">
                    <div class="left">
                        <label>性别:</label>
                    </div>
                    <div class="right">
                        <div class="radio radio-danger">
                            <input type="radio" name="gender" id="male" value="1" checked>
                            <label for="male">
                                男
                            </label>
                        </div>
                        <div class="radio radio-danger">
                            <input type="radio" name="gender" id="female" value="2">
                            <label for="female">
                                女
                            </label>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <div class="left">
                        <label>旧密码：</label>
                    </div>
                    <div class="right">
                        <input type="password" class="form-control" name="beforepass" id="beforepass"/>
                    </div>
                    <label class="error" for="beforepass" id="beforepass_error">这是必填栏。</label>
                </div>
                <div class="form-group">
                    <div class="left">
                        <label>新密码：</label>
                    </div>
                    <div class="right">
                        <input type="password" class="form-control" name="newpass" id="newpass"/>
                    </div>
                    <label class="error" for="newpass" id="newpass_error">这是必填栏。</label>
                </div>
                <div class="form-group">
                    <div class="left">
                        <label>确认密码：</label>
                    </div>
                    <div class="right">
                        <input type="password" class="form-control"  name="verifypass" id="verifypass"/>
                    </div>
                    <label class="error" for="verifypass" id="verifypass_error">这是必填栏。</label>
                </div>
                <div class="form-group">
                    <div class="left">
                        <label>职业：</label>
                    </div>
                    <div class="right">
                        <select class="form-control" style="height:36px" id="occupation" name="occupation">
                            {foreach :model('EducationType')->all() as $key=>$val }
                                <option value="{$val.id}">{$val.name}</option>
                            {/foreach}
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <div class="left">
                        <label>学历：</label>
                    </div>
                    <div class="right">
                        <select class="form-control" style="height:36px" id="education" name="education">
                            {foreach :model('JobType')->all() as $key=>$val }
                                <option value="{$val.id}">{$val.name}</option>
                            {/foreach}
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <div class="left">
                        <label>手机号码：</label>
                    </div>
                    <div class="right">
                        <input type="number" class="form-control" style="width:200px;float:left;margin-right:10px" id="cellphone" name="cellphone" value="{$user_data[0]['mobile']}" readonly/>
                        <a href="#changePhoneNumber" role="button" class="btn" data-toggle="modal" style="float:left;width:90px;background-color:#ff5656;margin-top:-6px;height:36px;border-radius:0px"> 修改手机 </a>
                    </div>
                    <label class="error" for="cellphone" id="cellphone_error">这是必填栏。</label>
                </div>
                <div class="form-group">
                    <div class="left">
                        <label>固定电话：</label>
                    </div>
                    <div class="right">
                        <input type="text" class="form-control" id="fixed" name="fixed"/>
                    </div>
                    <label class="error" for="fixed" id="fixed_error">这是必填栏。</label>
                </div>
                <div class="form-group">
                    <div class="left">
                        <label>E-mail：</label>
                    </div>
                    <div class="right">
                        <input type="text" class="form-control" id="email" name="email"/>
                    </div>
                    <label class="error" for="email" id="email_error">这是必填栏。</label>
                </div>
                <div class="form-group" style="padding-top:11px;border-bottom: none;">
                    <div class="left" style="height:1px">
                    </div>
                    <div class="right">
                        <button class="btn" style="margin-right:15px;background-color:#ff5656" id="save">保存</button>
                        <button class="btn" style="background-color:#ffc750">返回</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<div id="changePhoneNumber" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="changePhoneNumberLabel" aria-hidden="true" style="display: none;">
    <div class="modal-dialog container" style="width:452px;margin-top:200px">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
            </div>
            <div class="modal-body" style="padding-bottom:34px">
                <div class="container login-title" style="border-top: 1px solid #ff5656;width: 330px;margin-top: 2px;margin-bottom:15px;">
                    <p style="font-family: ms-yahei-bold;color: #ff5656;font-size: 18px;margin-top: -15px;margin-bottom:0px;background-color: white;width: 111px;margin-left: 109px;padding-left: 20px;padding-right: 0px;">修改手机</p>
                </div>

                <div class="form">
                    <form role="form">
                        <div class="form-group">
                            <div class="left">
                                <label>手机号码：</label>
                            </div>
                            <div class="right">
                                <input type="text" class="form-control" />
                            </div>
                            <div class="error"></div>
                        </div>
                        <div class="form-group">
                            <div class="left">
                                <label>手机验证：</label>
                            </div>
                            <div class="right">
                                <div class="input-group">
                                    <input type="text" class="form-control" style="width:190px;">
                                    <span class="input-group-btn">
                                        <button class="btn" type="button">获取验证码</button>
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="left">
                                <label>新手机号：</label>
                            </div>
                            <div class="right">
                                <input type="text" class="form-control" />
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="left">
                                <label>手机验证：</label>
                            </div>
                            <div class="right">
                                <div class="input-group">
                                    <input type="text" class="form-control" style="width:190px;">
                                    <span class="input-group-btn">
                                        <button class="btn" type="button">获取验证码</button>
                                    </span>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <div class="left" style="height:1px">
                            </div>
                            <div class="right">
                                <button type="button" class="btn" onclick="javascript:onModalOK();" style="    background-color: #ff5656;color: white;height: 40px;width: 200px;padding-left: 11px;padding-top: 7px;font-size: 18px;">确认新增</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{/block}
{block name="custom-js"}
<script>
    $(document).ready(function () {
        $('.error').hide();
        $("input#username").focus();
    })

    $("#personal_form").submit(function (e)
    {
        e.preventDefault();
        validation();
        var formData = $(this).serialize();
        console.log(formData);
        $.ajax({
            url : '/index/data_management.personal_information/0',
            method : 'PUT',
            data : formData,
            success:function (result) {
                if(result=='ok')
                    reset();
                else if (result == "failure")
                    alert("your old password is wrong,correctly insert password");
                    // $("input#beforepass").focus();

            }
        })
    });



    //email check
    function isValidEmailAddress(email) {
        var regex = /^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;
        return regex.test(email);
    }

    function validation() {
        $('.error').hide();
        var username = $("input#username").val();
        if (username == "") {
            $("label#username_error").show();
            $("input#username").focus();
            return false;
        }
        var realname = $("input#realname").val();
        if (realname == "") {
            $("label#realname_error").show();
            $("input#realname").focus();
            return false;
        }
        var beforepass = $("input#beforepass").val();
        if (beforepass == "") {
            $("label#beforepass_error").show();
            $("input#beforepass").focus();
            return false;
        }
        var newpass = $("input#newpass").val();
        if (newpass == "") {
            $("label#newpass_error").show();
            $("input#newpass").focus();
            return false;
        }
        var verifypass = $("input#verifypass").val();
        if (verifypass == "") {
            $("label#verifypass_error").show();
            $("input#verifypass").focus();
            return false;
        }
        if (newpass !== verifypass) {
            $("label#verifypass_error").text("密码不一样");
            $("label#verifypass_error").show();
            $("input#verifypass").focus();
            return false;
        }
        var cellphone = $("input#cellphone").val();
        if (cellphone == "") {
            $("label#cellphone_error").show();
            $("input#cellphone").focus();
            return false;
        }

        var fixed = $("input#fixed").val();
        if (fixed == "") {
            $("label#fixed_error").show();
            $("input#fixed").focus();
            return false;
        }
        var email = $("input#email").val();
        if (email == "") {
            $("label#email_error").show();
            $("input#email").focus();
            return false;
        }

        if (!isValidEmailAddress(email)) {
            $("label#email_error").text("请插入正确的邮箱地址");
            $("label#email_error").show();
            $("input#email").focus();
            return false;
        }
    }

    function reset()
    {
        var $inputs = $('#personal_form :input');
        var values = {};
        $inputs.each(function() {
            values[this.name] = $(this).val('');
        });
        $("input#username").focus();
    }

</script>
{/block}